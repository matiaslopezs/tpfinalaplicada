<!DOCTYPE html>
<html lang="es">
<head>
    <meta charset="UTF-8">
    <title>TP APLICADA</title>
    <link href="https://fonts.googleapis.com/css2?family=Orbitron:wght@500&display=swap" rel="stylesheet">
    <script src="https://code.jquery.com/jquery-3.5.1.slim.js" integrity="sha256-DrT5NfxfbHvMHux31Lkhxg42LY6of8TaYyK50jnxRnM=" crossorigin="anonymous"></script>
    <style>
        .center{
            display: flex;
            align-items: center;
            justify-content: center;
        }
        *{
            padding: 0;
            margin: 0;
            user-select: none;
            -moz-user-select: none;
            -khtml-user-select: none;
            -webkit-user-select: none;
            -o-user-select: none;
        }
        .container{
            display: flex;
            flex-direction: column;
            justify-content: center;
            align-items: center;
            height:100vh;
        }
        .img-container{
            height:70vh;
            position:relative;
        }
        .oven{
            height:100%;
        }
        .cover-data{
            position: absolute;
            top: 4%;
            left: 50%;
            transform: translateX(-50%);
            width:20%;
            height: 12%;
            background-color: black;
            border-radius:5px;
            display: flex;
            flex-direction: column;
            align-items: center;
            padding: 2%;
            font-size:3vh;
            justify-content: space-around;
        }
        .data-text{
            opacity: 0.7;
            color: #38b632;
            font-family: 'Orbitron', sans-serif;
        }
        .hl{
            background-color: white;
            width:100%;
            height: 2px;
            opacity: 0.3;
        }
        .img{
            height:100%;
        }
        /* CAMBIAR TEMPERATURA */
        .camb-temp{
            position: absolute;
            width:14%;
            height:14%;
            border-radius:50%;
            background-color: white;
            top:4%;
            left: 19%;
            font-size:2vh;
        }
        .mns-temp{
            z-index:20;
            position: absolute;
            top:-140%;
            left:-135%;
            background-color:blue;
            border-radius:10px;
            padding:10px;
            width: 300%;
            font-family: 'Orbitron', sans-serif;
            color: white;
            font-size:2vh;
        }
        .mns-temp::before{
            content:"";
            position: absolute;
            width:30px;
            height: 30px;
            top:100%;
            left:50%;
            background-color: blue;
            transform: rotate(45deg) translate(-50%, -50%);
            z-index:-1;
        }
        .camb-tiempo-img,
        .camb-temp-img{
            position: absolute;
            width:60%;
            height:60%;
        }
        /* CAMBIAR TIEMPO */
        .camb-tiempo{
            position: absolute;
            width:14%;
            height:14%;
            border-radius:50%;
            background-color: white;
            top:4%;
            left: 67%;
            font-size:2vh;
        }
        .mns-tiempo{
            z-index:20;
            position: absolute;
            top:-140%;
            left:-90%;
            background-color:blue;
            border-radius:10px;
            padding:10px;
            width: 300%;
            font-family: 'Orbitron', sans-serif;
            color: white;
            font-size:2vh;
        }
        .mns-tiempo::before{
            content:"";
            position: absolute;
            width:30px;
            height:30px;
            top:100%;
            left:40%;
            background-color: blue;
            transform: rotate(45deg) translate(-50%, -50%);
            z-index:-1;
        }
        /* INICIAR */
        .btn-iniciar{
            position: absolute;
            color: white;
            background-color: blue;
            padding: 10px 20px;
            border-radius:50px;
            font-family:'Orbitron', sans-serif;
            font-size: 30px;
            margin-top:20px;
            top: 100%;
            transform:translateY(-200%);
            cursor: pointer;
            transition: 0.3s;
        }
        .btn-iniciar:hover{
            box-shadow:0 0 5px 10px #6464ff;
        }
        .cocinando{
            z-index:50;
            width: 60%;
            height: 40%;
            position: absolute;
            top:50%;
            left:50%;
            transform: translate(-50%, -30%);
            background-color: red;
            box-shadow:0 0 20px 20px red;
            opacity:0.4;
        }
    </style>
</head>
<body>
<div class="container">
    <div class="img-container">
        <img class="oven" src="https://drive.google.com/uc?id=18SKVgL7k12QN0zQdo5M4TSFtfMhSbrrZ" alt="">
        <div class="cocinando"></div>
        <!-- MOSTRAR DATOS -->
        <div class="cover-data">
            <!-- TEMPERATURA -->
            <div style="display:flex;flex-direction:row">
                <span class="data-text temp"></span>
            </div>
            <!-- TIEMPO -->
            <div class="hl"></div>
            <div style="display:flex;flex-direction:row">
                <span class="data-text tiempo"></span>
            </div>
        </div>
        <!-- CAMBIAR TEMPERATURA -->
        <div class="center camb-temp">
            <!--<span class="camb-temp-img center">TEMP</span>-->
            <img class="img" src="https://drive.google.com/uc?id=1HfNFQrVggEOtYRafdMoM6pZhOBFRYNUv" alt="">
            <img class="camb-temp-img img" src="https://drive.google.com/uc?id=1rOQPZBuWBkM3hd8b5uuLnb3cy5f3qvT0" alt="">
            <!-- MENSAJE -->
            <div class="mns-temp">
                Gira la manecilla con tu mouse para cambiar la temperatura.
            </div>
        </div>
        <!-- CAMBIAR TIEMPO -->
        <div class="camb-tiempo" style="display:flex;align-items:center;justify-content:center">
            <img class="img" src="https://drive.google.com/uc?id=1tBSicPWgJsqXe5V9IWGbOs1beWYanYW6" alt="">
            <img class="camb-tiempo-img img" src="https://drive.google.com/uc?id=1rOQPZBuWBkM3hd8b5uuLnb3cy5f3qvT0" alt="">
            <!-- MENSAJE -->
            <div class="mns-tiempo">
                Gira la manecilla con tu mouse para cambiar el tiempo de cocinado.
            </div>
        </div>
    </div>
    <!-- INICIAR -->
    <div class="btn-iniciar">START!</div>
</div>

<script>
    let cocinando = false;
    const initTemp = 160;
    const initTiempo = getTiempo(5.00);
    // Valores iniciales
    $('.temp').html(initTemp + '°');
    $('.tiempo').html('5:00');
    $('.img').attr('draggable', false);
    $('.cocinando').css('display', cocinando?'':'none');
    $('.btn-iniciar').click(()=>{
        cocinando = true;
        alert('Falta obtener y mostrar datos desde el back-end...');
    });
    //
    // CAMBIAR TEMPERATURA
    //
    let cambTempMouseDown = false;
    $('.camb-temp').mousedown((e) => { actualizarTemperatura(e); cambTempMouseDown = true; });
    $(document).mouseup(() => { cambTempMouseDown = false; });
    $(document).mousemove((e) => { if (cambTempMouseDown) actualizarTemperatura(e); });
    function actualizarTemperatura(e) {
        if (cocinando) return;
        let maxAngulo = 270;
        let angulo = getAngulo(e); // minAngulo = 0;
        if (angulo > maxAngulo) angulo = angulo < maxAngulo + (360 - maxAngulo) / 2 ? angulo = maxAngulo : 0;
        let minTemp = 160;
        let maxTemp = 230;
        let difTemp = maxTemp - minTemp; // intervalo de temperaturas
        // Hallar temperatura actual por regla de tres simple según el ángulo dado:
        // difTemp -> maxAngulo
        //       x -> angulo
        // x = difTemp * angulo / maxAngulo
        let tempActual = difTemp * angulo / maxAngulo + minTemp;
        // Actualizar visor electrónico
        $('.temp').html(tempActual.toFixed(2).toString() + '°');
        // Actualizar posición de la manecilla
        $('.camb-temp-img').css('transform', `rotate(${angulo}deg)`);
    }
    //
    // CAMBIAR TIEMPO
    //
    let cambTiempoMouseDown = false;
    $('.camb-tiempo').mousedown((e) => { actualizarTiempo(e); cambTiempoMouseDown = true; });
    $(document).mouseup(() => { cambTiempoMouseDown = false; });
    $(document).mousemove((e) => { if (cambTiempoMouseDown) actualizarTiempo(e); });
    function actualizarTiempo(e) {
        if (cocinando) return;
        let maxAngulo = 270;
        let angulo = getAngulo(e); // minAngulo = 0;
        if (angulo > maxAngulo) angulo = angulo < maxAngulo + (360 - maxAngulo) / 2 ? angulo = maxAngulo : 0;
        let minTemp = 5;
        let maxTemp = 20;
        let difTiempo = maxTemp - minTemp; // intervalo de tiempos
        // Hallar temperatura actual por regla de tres simple según el ángulo dado:
        // difTiempo -> maxAngulo
        //         x -> angulo
        // x = difTemp * angulo / maxAngulo
        let tiempoActual = difTiempo * angulo / maxAngulo + minTemp;
        // Actualizar visor electrónico
        $('.tiempo').html(getTiempo(tiempoActual.toFixed(2)));
        // Actualizar posición de la manecilla
        $('.camb-tiempo-img').css('transform', `rotate(${angulo}deg)`);
    }
    //
    // MÁS FUNCIONES
    //
    function getTiempo(t){
        let tiempos = t.toString().split('.');
        if (tiempos[1]) tiempos[1] = (parseInt(tiempos[1]) * 0.6).toFixed(0).toString();
        else tiempos[1] = '00';
        return tiempos.join(':');
    }
    function getAngulo(e) {
        let p0 = { x: $(e.target).offset().left + $(e.target).outerWidth() / 2, y: $(e.target).offset().top + $(e.target).outerHeight() / 2 };
        let v2 = { x: e.pageX - p0.x, y: e.pageY - p0.y };
        let v1 = { x: 0, y: -1 };
        let a = Math.atan2(v1.x*v2.y-v1.y*v2.x, v1.x*v2.x+v1.y*v2.y)  * 180 / Math.PI;
        return a < 0 ? a + 360 : a;
    }
</script>
</body>
</html>